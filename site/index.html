<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mesh Sandbox — Minimal E2E</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <script>
      window.APP_CONFIG = window.APP_CONFIG || {
        apiBase: "https://p26ujrcetd.execute-api.us-east-1.amazonaws.com",
        meshClientId: "2195a20c-f0da-4c1d-f6ea-08de0fed221d"
      };
      window.MESH_LINK_SDK_URL = window.MESH_LINK_SDK_URL || "https://cdn.meshconnect.com/web-sdk/latest/mesh.js";
    </script>
  </head>
  <body>
    <main class="layout">
      <header>
        <h1>Mesh Sandbox — Minimal E2E</h1>
        <p class="lede">
          Connect a Coinbase sandbox account with Mesh Link, approve the $50 USDC transfer, then read the portfolio data using the AWS-powered API in this repo.
        </p>
        <div id="status" class="status"></div>
      </header>

      <section class="card">
        <h2>1. Connect to Coinbase via Mesh Link</h2>
        <p>
          Fetch a Link token from the Lambda API and launch Mesh Web Link. Use sandbox MFA code <code>123456</code> when prompted.
        </p>
        <button id="connect-btn" class="primary">Launch Mesh Link</button>
        <div id="link-diagnostics" class="note"></div>
      </section>

      <section class="card">
        <h2>2. Pay for the $50 shoes</h2>
        <p>
          Request a transfer-configured Link token. Mesh Link will open ready to approve the USDC payment to the demo wallet.
        </p>
        <button id="pay-btn" class="primary">Pay $50 in USDC</button>
        <div class="note">
          Defaults use Ethereum network <code>e3c7fdd8-b1fc-4e51-85ae-bb276e075611</code> and wallet <code>0x0Ff0000f0A0f0000F0F000000000ffFf00f0F0f0</code> from your Mesh sandbox config.
        </div>
      </section>

      <section class="card">
        <h2>3. Show the Coinbase portfolio</h2>
        <p>
          The latest access token is stored below after a successful connection. Use it to fetch balances and positions.
        </p>
        <textarea id="access-token" rows="3" readonly placeholder="Connect first to populate the access token."></textarea>
        <div class="form-row">
          <label>
            Account ID (optional)
            <input id="account-id" placeholder="Auto-selected from Mesh payload" autocomplete="off">
          </label>
          <label>
            Portfolio type
            <input id="portfolio-type" value="coinbase" autocomplete="off">
          </label>
        </div>
        <button id="portfolio-btn" class="secondary">Read Portfolio</button>
      </section>

      <section class="card output">
        <div class="output-header">
          <h2>API responses</h2>
          <button id="clear-output" class="link-like" type="button">Clear</button>
        </div>
        <pre id="out" aria-live="polite"></pre>
      </section>
    </main>

    <script type="module" src="app.js"></script>
  </body>
</html>
